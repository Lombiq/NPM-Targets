<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <!-- Set "NpmTargetsWorkingDirectory" before importing this file to adjust all dependent properties at once. -->
    <NpmTargetsWorkingDirectory
      Condition="'$(NpmTargetsWorkingDirectory)' == ''">$(MSBuildProjectDirectory)</NpmTargetsWorkingDirectory>
    <!-- Using Path.Combine() here to account for possible trailing (back)slash on "NpmTargetsWorkingDirectory". -->
    <NodeModulesFolderPath>$( [System.IO.Path]::Combine( $(NpmTargetsWorkingDirectory), 'node_modules' ) )</NodeModulesFolderPath>
    <PackageJson>$( [System.IO.Path]::Combine( $(NpmTargetsWorkingDirectory), 'package.json' ) )</PackageJson>
    <NpmCommandsEnvironmentVariables Condition="'$(NpmCommandsEnvironmentVariables)' == ''"></NpmCommandsEnvironmentVariables>
  </PropertyGroup>

  <PropertyGroup>
    <ExecNpmInstallCommand>true</ExecNpmInstallCommand>
    <NpmInstallCommand>npm install</NpmInstallCommand>
    <PnpmInstallCommand>pnpm install</PnpmInstallCommand>
    <CreateNpmInstallStampFile>true</CreateNpmInstallStampFile>
    <NpmInstallStampFile>$(NodeModulesFolderPath)/.install-stamp</NpmInstallStampFile>
  </PropertyGroup>

  <PropertyGroup>
    <ExecDotnetPostcleanCommand>true</ExecDotnetPostcleanCommand>
    <NpmDotnetPostcleanCommand>npm run dotnet-postclean --if-present</NpmDotnetPostcleanCommand>
  </PropertyGroup>

  <PropertyGroup>
    <ExecDotnetPrebuildCommand>true</ExecDotnetPrebuildCommand>
    <NpmDotnetPrebuildCommand>npm run dotnet-prebuild --if-present</NpmDotnetPrebuildCommand>
    <CreateDotnetPrebuildStampFile>true</CreateDotnetPrebuildStampFile>
    <NpmDotnetPrebuildStampFile>$(NodeModulesFolderPath)/.dotnet-prebuild-stamp</NpmDotnetPrebuildStampFile>
  </PropertyGroup>

  <ItemGroup>
    <!-- TODO: Prepend with WD path using CombinePaths task -->
    <NpmDotnetPrebuildWatchedFiles Include="package.json;Assets/**/*.*;Scripts/**/*.*;Styles/**/*.*" />
    <NpmCommandsEnvironmentVariables Include="$(NpmCommandsEnvironmentVariables)" />
  </ItemGroup>

</Project>
